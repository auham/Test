<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a1a2e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ø§Ù„Ù…Ø±ÙŠØ¨ÙŠØ·">
    <title>Ø¯Ø¹ÙˆØ§Øª Ø§Ù„Ù…Ø±ÙŠØ¨ÙŠØ·</title>
    
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ’’</text></svg>">
    <link rel="manifest" href="/Test/manifest.json">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    
    <style>
        #notification-bar {
            display: none;
            background: linear-gradient(90deg, #D4AF37, #f1d27b);
            color: #1a1a2e;
            padding: 12px;
            text-align: center;
            font-weight: bold;
            cursor: pointer;
            position: sticky;
            top: 0;
            z-index: 10000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            font-family: 'Tajawal', sans-serif;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Tajawal', Arial, sans-serif; }
        :root { --gold: #D4AF37; --gold-light: #E8C547; --dark-bg: #1a1a2e; --dark-card: #16213e; --text-light: #e2e2e2; --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        body { background-color: var(--dark-bg); background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #1a1a2e 100%); min-height: 100vh; color: white; line-height: 1.6; overflow-x: hidden; -webkit-tap-highlight-color: transparent; }
        .header { background: linear-gradient(90deg, #1a1a2e, #16213e); border-bottom: 2px solid var(--gold); padding: 1rem; position: sticky; top: 0; z-index: 100; box-shadow: 0 4px 20px rgba(0,0,0,0.4); }
        .header-content { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
        .header h1 { color: var(--gold); font-size: 1.5rem; font-weight: 800; letter-spacing: 1px; }
        .header p { color: #888; font-size: 0.75rem; margin-top: 2px; }
        .header-btn { background: none; border: none; color: var(--gold); cursor: pointer; padding: 0.5rem; border-radius: 50%; transition: var(--transition); width: 44px; height: 44px; display: flex; align-items: center; justify-content: center; position: relative; }
        .header-btn:hover { background: rgba(212, 175, 55, 0.1); transform: scale(1.1); }
        .notification-badge { position: absolute; top: -5px; right: -5px; background: #ef4444; color: white; font-size: 0.7rem; padding: 2px 6px; border-radius: 50%; min-width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 2px solid var(--dark-bg); }
        .nav-tabs { display: flex; justify-content: center; gap: 0.5rem; padding: 1rem; background: rgba(0,0,0,0.2); backdrop-filter: blur(10px); position: sticky; top: 74px; z-index: 90; flex-wrap: wrap; }
        .nav-tab { background: rgba(212, 175, 55, 0.05); border: 1px solid rgba(212, 175, 55, 0.2); color: var(--gold); padding: 0.6rem 1.2rem; border-radius: 25px; cursor: pointer; transition: var(--transition); font-weight: 500; font-size: 0.95rem; }
        .nav-tab:hover { background: rgba(212, 175, 55, 0.15); }
        .nav-tab.active { background: var(--gold); color: var(--dark-bg); border-color: var(--gold); box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3); }
        .container { max-width: 1200px; margin: 0 auto; padding: 1.5rem; animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .section-title { text-align: center; margin-bottom: 2rem; position: relative; }
        .section-title h2 { color: var(--gold); font-size: 1.8rem; font-weight: 800; margin-bottom: 0.5rem; }
        .section-title::after { content: ''; display: block; width: 60px; height: 3px; background: var(--gold); margin: 10px auto; border-radius: 2px; }
        .cards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 1.5rem; }
        .wedding-card { background: linear-gradient(135deg, var(--dark-card), #1a1a2e); border-radius: 24px; overflow: hidden; border: 1px solid rgba(212, 175, 55, 0.2); cursor: pointer; transition: var(--transition); position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .wedding-card:hover { transform: translateY(-10px); border-color: var(--gold); box-shadow: 0 15px 40px rgba(0,0,0,0.5); }
        .card-image { height: 220px; background-size: cover; background-position: center; position: relative; }
        .card-image::after { content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 50%; background: linear-gradient(to top, rgba(22, 33, 62, 1), transparent); }
        .card-content { padding: 1.5rem; position: relative; }
        .groom-name { color: var(--gold); font-size: 1.6rem; font-weight: 700; margin-bottom: 0.8rem; line-height: 1.2; }
        .info-item { display: flex; align-items: center; gap: 0.8rem; color: var(--text-light); margin-bottom: 0.6rem; font-size: 0.95rem; justify-content: flex-end; }
        .info-item svg { color: var(--gold); flex-shrink: 0; }
        .side-menu { position: fixed; top: 0; right: -300px; width: 300px; height: 100vh; background: var(--dark-bg); z-index: 1000; transition: var(--transition); padding: 2rem; box-shadow: -10px 0 30px rgba(0,0,0,0.5); border-left: 1px solid rgba(212, 175, 55, 0.2); }
        .side-menu.active { right: 0; }
        .menu-overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.7); z-index: 999; display: none; backdrop-filter: blur(4px); }
        .menu-overlay.active { display: block; }
        .menu-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2.5rem; }
        .menu-item { display: flex; align-items: center; gap: 1rem; color: white; text-decoration: none; padding: 1rem; border-radius: 12px; transition: var(--transition); margin-bottom: 0.5rem; cursor: pointer; justify-content: flex-end; }
        .menu-item:hover { background: rgba(212, 175, 55, 0.1); color: var(--gold); }
    </style>
</head>
<body>
    <div id="notification-bar">Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„ØªÙØ¹ÙŠÙ„ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø²ÙˆØ§Ø¬Ø§Øª ÙˆØ§Ù„Ø£Ø®Ø¨Ø§Ø± ğŸ””</div>
    <div id="app"></div>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAJwhgVyeTKswA22f0xA8rnxTve5qvhsHM",
            authDomain: "almuraibet.firebaseapp.com",
            projectId: "almuraibet",
            storageBucket: "almuraibet.firebasestorage.app",
            messagingSenderId: "87515804054",
            appId: "1:87515804054:web:e98aab9bee5ac9cc4c6db7"
        };
        const FIRESTORE_URL = `https://firestore.googleapis.com/v1/projects/${firebaseConfig.projectId}/databases/(default)/documents`;
        const AUTH_URL = `https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key=${firebaseConfig.apiKey}`;
        const state = { currentView: 'home', isAuthenticated: false, authToken: null, weddings: [], news: [], notifications: [], selectedWedding: null, menuOpen: false };
        const icons = {
            menu: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>`,
            bell: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>`,
            calendar: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>`,
            mapPin: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>`,
            x: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>`
        };

        async function fetchWeddings() { try { const res = await fetch(`${FIRESTORE_URL}/weddings`); const data = await res.json(); if (data.documents) state.weddings = data.documents.map(parseFirestoreDoc).sort((a,b) => new Date(a.date) - new Date(b.date)); } catch (e) { console.error(e); } }
        async function fetchNews() { try { const res = await fetch(`${FIRESTORE_URL}/news`); const data = await res.json(); if (data.documents) state.news = data.documents.map(parseFirestoreDoc); } catch (e) { console.error(e); } }
        async function fetchNotifications() { try { const res = await fetch(`${FIRESTORE_URL}/notifications`); const data = await res.json(); if (data.documents) state.notifications = data.documents.map(parseFirestoreDoc); } catch (e) { console.error(e); } }
        function parseFirestoreDoc(doc) { const obj = { id: doc.name.split('/').pop() }; for (let key in doc.fields) { obj[key] = doc.fields[key].stringValue || doc.fields[key].integerValue || doc.fields[key].timestampValue; } return obj; }

        function navigateTo(view) { state.currentView = view; state.menuOpen = false; render(); window.scrollTo(0,0); }
        function toggleMenu() { state.menuOpen = !state.menuOpen; render(); }
        function openWedding(id) { state.selectedWedding = state.weddings.find(w => w.id === id); render(); }
        function closeWedding() { state.selectedWedding = null; render(); }

        function renderHeader() { return `<header class="header"><div class="header-content"><button class="header-btn" onclick="toggleMenu()">${icons.menu}</button><div style="text-align: center;"><h1>Ø¯Ø¹ÙˆØ§Øª Ø§Ù„Ù…Ø±ÙŠØ¨ÙŠØ·</h1><p>ÙˆØ§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ù‚Ø¨Ù„ÙŠØ©</p></div><button class="header-btn" onclick="navigateTo('notifications')">${icons.bell}${state.notifications.length ? `<span class="notification-badge">${state.notifications.length}</span>` : ''}</button></div></header>`; }
        function renderNav() { return `<div class="nav-tabs"><button class="nav-tab ${state.currentView === 'home'?'active':''}" onclick="navigateTo('home')">Ø§Ù„Ø¯Ø¹ÙˆØ§Øª</button><button class="nav-tab ${state.currentView === 'news'?'active':''}" onclick="navigateTo('news')">Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</button><button class="nav-tab ${state.currentView === 'about'?'active':''}" onclick="navigateTo('about')">Ø¹Ù† Ø§Ù„Ù‚Ø¨ÙŠÙ„Ø©</button></div>`; }
        function renderHome() { return `<div class="container"><div class="section-title"><h2>Ø§Ù„Ø¯Ø¹ÙˆØ§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</h2></div><div class="cards-grid">${state.weddings.map(w => `<div class="wedding-card" onclick="openWedding('${w.id}')"><div class="card-image" style="background-image: url('${w.image || 'https://images.unsplash.com/photo-1519741497674-611481863552?w=800'}')"></div><div class="card-content"><h4 class="groom-name">${w.groom}</h4><div class="info-item"><span>${w.date}</span>${icons.calendar}</div><div class="info-item"><span>${w.location}</span>${icons.mapPin}</div></div></div>`).join('')}</div></div>`; }
        function renderSideMenu() { return `<div class="menu-overlay ${state.menuOpen?'active':''}" onclick="toggleMenu()"></div><div class="side-menu ${state.menuOpen?'active':''}" style="text-align: right;"><div class="menu-header"><button class="header-btn" onclick="toggleMenu()">${icons.x}</button><h3 style="color: var(--gold);">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h3></div><div class="menu-item" onclick="navigateTo('home')">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div><div class="menu-item" onclick="navigateTo('admin')">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</div></div>`; }

        function render() {
            let content = '';
            switch(state.currentView) {
                case 'news': content = `<div class="container"><h2>Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</h2></div>`; break;
                case 'admin': content = `<div class="container"><h2>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2><p>ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</p></div>`; break;
                default: content = renderHome();
            }
            document.getElementById('app').innerHTML = renderHeader() + renderSideMenu() + renderNav() + content;
            if (state.selectedWedding) {
                const w = state.selectedWedding;
                const modal = document.createElement('div');
                modal.className = 'modal-overlay';
                modal.innerHTML = `<div class="modal" style="padding: 2rem; color: white; position: relative;"><button onclick="closeWedding()" style="position: absolute; top: 10px; right: 10px; background: none; border: none; color: var(--gold);">${icons.x}</button><h2 style="color: var(--gold); margin-bottom: 1rem;">${w.groom}</h2><p>${w.details || 'Ù†Ø±Ø­Ø¨ Ø¨ÙƒÙ… Ø¬Ù…ÙŠØ¹Ø§Ù‹'}</p><br><p>${icons.calendar} ${w.date}</p><p>${icons.mapPin} ${w.location}</p></div>`;
                document.getElementById('app').appendChild(modal);
            }
        }

        // ==================== Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ====================
        const notifyBar = document.getElementById('notification-bar');
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/Test/sw.js').then(reg => {
                    console.log('SW Registered');
                    if (Notification.permission === 'default') {
                        notifyBar.style.display = 'block';
                    }
                }).catch(err => console.error('SW Error', err));
            });
        }

        notifyBar.onclick = function() {
            Notification.requestPermission().then(permission => {
                if (permission === 'granted') {
                    alert('ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!');
                    notifyBar.style.display = 'none';
                } else {
                    alert('ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­');
                }
            });
        };

        async function init() {
            document.getElementById('app').innerHTML = `<div class="loading"><div class="spinner"></div><p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p></div>`;
            await Promise.all([fetchWeddings(), fetchNews(), fetchNotifications()]);
            render();
        }
        init();
    </script>
</body>
</html>
